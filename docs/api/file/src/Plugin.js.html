<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Plugin.js | esdoc-plugin-requires-coverage API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/ls-age/esdoc-plugin-require-coverage" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Plugin.js~Plugin.html">Plugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onComplete">onComplete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onHandleConfig">onHandleConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onStart">onStart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-plugin">plugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://esdoc.org/esdoc/class/src/Plugin/Plugin.js~PluginEvent.html">PluginEvent</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Plugin.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { join } from &apos;path&apos;;
import { readFileSync } from &apos;fs&apos;;
import { EOL } from &apos;os&apos;;

/**
 * The require-coverage plugin
 */
export default class Plugin {

  /**
   * The default options to use
   * @type {Object}
   * @property {Number} required=90 The coverage percentage required
   */
  static get DefaultOptions() {
    return {
      required: 90,
    };
  }

  /**
   * Handles options passed through the plugin key inside esdoc.json
   * @param {Object} [options] The options to use
   * @param {Number} [options.required=Plugin.DefaultOptions.required] The coverage percentage
   * required
   */
  handleOptions(options) {
    const opts = Object.assign(Plugin.DefaultOptions, options);

    /**
     * The coverage percentage required
     * @type {Number}
     */
    this._required = opts.required;
  }

  /**
   * Handles configuration passed in esdoc.json
   * @param {Object} config The ESDoc configuration stored inside esdoc.json
   * @param {String} config.destination Needed for plugin to work
   */
  handleConfig(config) {
    /**
     * Path to the coverage.json file generated by ESDoc
     */
    this._coverageFilePath = join(config.destination, &apos;coverage.json&apos;);
  }

  /**
   * Checks the docs coverage against the limit specified in options
   * @throws {Error} Throws an error if coverage.json-file cannot be found
   * @throws {Error} Throws an error if coverage percentage is less than required
   */
  checkCoverage() {
    let coverageReport;

    try {
      coverageReport = JSON.parse(readFileSync(this._coverageFilePath));
    } catch (_) {
      throw new Error(&apos;coverage.json file not found. Double-check ESDoc finished.&apos;);
    }

    const covered = parseInt(/([0-9]+)%/.exec(coverageReport.coverage)[1], 10);

    if (covered &lt; this._required) {
      throw new Error(`Coverage is at ${covered}%, (${this._required}% required)${EOL}`);
    }
  }

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
